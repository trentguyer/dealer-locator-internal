<!DOCTYPE html PUBLIC "-//W3C//DTD HTML 4.01//EN" "http://www.w3.org/TR/html4/strict.dtd">
<html>
<head>
  <meta http-equiv="Content-Type" content="text/html; charset=utf-8">
  <meta http-equiv="Content-Style-Type" content="text/css">
  <title></title>
  <meta name="Generator" content="Cocoa HTML Writer">
  <meta name="CocoaVersion" content="2487.4">
  <style type="text/css">
    p.p1 {margin: 0.0px 0.0px 0.0px 0.0px; font: 12.0px Helvetica}
    p.p2 {margin: 0.0px 0.0px 0.0px 0.0px; font: 12.0px Helvetica; min-height: 14.0px}
  </style>
</head>
<body>
<p class="p1">&lt;!DOCTYPE html&gt;</p>
<p class="p1">&lt;html&gt;</p>
<p class="p2"><br></p>
<p class="p1">&lt;head&gt;</p>
<p class="p1"><span class="Apple-converted-space">  </span>&lt;meta charset='utf-8' /&gt;</p>
<p class="p1"><span class="Apple-converted-space">  </span>&lt;title&gt;&lt;/title&gt;</p>
<p class="p1"><span class="Apple-converted-space">  </span>&lt;meta name='viewport' content='initial-scale=1,maximum-scale=1,user-scalable=no' /&gt;</p>
<p class="p1"><span class="Apple-converted-space">  </span>&lt;script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.5.0/jquery.min.js"&gt;&lt;/script&gt;</p>
<p class="p1"><span class="Apple-converted-space">  </span>&lt;script src='https://api.mapbox.com/mapbox-gl-js/v2.0.1/mapbox-gl.js'&gt;&lt;/script&gt;</p>
<p class="p1"><span class="Apple-converted-space">  </span>&lt;link href='https://api.mapbox.com/mapbox-gl-js/v2.0.1/mapbox-gl.css' rel='stylesheet' /&gt;</p>
<p class="p1"><span class="Apple-converted-space">  </span>&lt;script src='https://npmcdn.com/csv2geojson@latest/csv2geojson.js'&gt;&lt;/script&gt;</p>
<p class="p1"><span class="Apple-converted-space">  </span>&lt;script src='https://npmcdn.com/@turf/turf/turf.min.js'&gt;&lt;/script&gt;</p>
<p class="p1"><span class="Apple-converted-space">  </span>&lt;style&gt;</p>
<p class="p1"><span class="Apple-converted-space">    </span>body {</p>
<p class="p1"><span class="Apple-converted-space">      </span>margin: 0;</p>
<p class="p1"><span class="Apple-converted-space">      </span>padding: 0;</p>
<p class="p1"><span class="Apple-converted-space">    </span>}</p>
<p class="p2"><br></p>
<p class="p1"><span class="Apple-converted-space">    </span>#map {</p>
<p class="p1"><span class="Apple-converted-space">      </span>position: absolute;</p>
<p class="p1"><span class="Apple-converted-space">      </span>top: 0;</p>
<p class="p1"><span class="Apple-converted-space">      </span>bottom: 0;</p>
<p class="p1"><span class="Apple-converted-space">      </span>width: 100%;</p>
<p class="p1"><span class="Apple-converted-space">    </span>}</p>
<p class="p2"><br></p>
<p class="p1"><span class="Apple-converted-space">    </span>/* Popup styling */</p>
<p class="p2"><br></p>
<p class="p1"><span class="Apple-converted-space">    </span>.mapboxgl-popup {</p>
<p class="p1"><span class="Apple-converted-space">      </span>padding-bottom: 5px;</p>
<p class="p1"><span class="Apple-converted-space">    </span>}</p>
<p class="p2"><br></p>
<p class="p1"><span class="Apple-converted-space">    </span>.mapboxgl-popup-close-button {</p>
<p class="p1"><span class="Apple-converted-space">      </span>display: none;</p>
<p class="p1"><span class="Apple-converted-space">    </span>}</p>
<p class="p2"><br></p>
<p class="p1"><span class="Apple-converted-space">    </span>.mapboxgl-popup-content {</p>
<p class="p1"><span class="Apple-converted-space">      </span>font: 400 15px/22px 'Source Sans Pro', 'Helvetica Neue', Sans-serif;</p>
<p class="p1"><span class="Apple-converted-space">      </span>padding: 0;</p>
<p class="p1"><span class="Apple-converted-space">      </span>width: 250px;</p>
<p class="p1"><span class="Apple-converted-space">    </span>}</p>
<p class="p2"><br></p>
<p class="p1"><span class="Apple-converted-space">    </span>.mapboxgl-popup-content-wrapper {</p>
<p class="p1"><span class="Apple-converted-space">      </span>padding: 1%;</p>
<p class="p1"><span class="Apple-converted-space">    </span>}</p>
<p class="p2"><br></p>
<p class="p1"><span class="Apple-converted-space">    </span>.mapboxgl-popup-content h3 {</p>
<p class="p1"><span class="Apple-converted-space">      </span>background: rgb(61, 59, 59);</p>
<p class="p1"><span class="Apple-converted-space">      </span>text-align: center;</p>
<p class="p1"><span class="Apple-converted-space">      </span>color: #fff;</p>
<p class="p1"><span class="Apple-converted-space">      </span>margin: 0;</p>
<p class="p1"><span class="Apple-converted-space">      </span>display: block;</p>
<p class="p1"><span class="Apple-converted-space">      </span>padding: 15px;</p>
<p class="p1"><span class="Apple-converted-space">      </span>font-weight: 700;</p>
<p class="p1"><span class="Apple-converted-space">      </span>margin-top: -5px;</p>
<p class="p1"><span class="Apple-converted-space">    </span>}</p>
<p class="p2"><br></p>
<p class="p1"><span class="Apple-converted-space">    </span>.mapboxgl-popup-content h4 {</p>
<p class="p1"><span class="Apple-converted-space">      </span>margin: 0;</p>
<p class="p1"><span class="Apple-converted-space">      </span>display: block;</p>
<p class="p1"><span class="Apple-converted-space">      </span>padding: 10px 3px 10px 10px;</p>
<p class="p1"><span class="Apple-converted-space">      </span>font-weight: 400;</p>
<p class="p1"><span class="Apple-converted-space">    </span>}</p>
<p class="p2"><br></p>
<p class="p1"><span class="Apple-converted-space">    </span>.mapboxgl-container {</p>
<p class="p1"><span class="Apple-converted-space">      </span>cursor: pointer;</p>
<p class="p1"><span class="Apple-converted-space">    </span>}</p>
<p class="p2"><br></p>
<p class="p1"><span class="Apple-converted-space">    </span>.mapboxgl-popup-anchor-top&gt;.mapboxgl-popup-content {</p>
<p class="p1"><span class="Apple-converted-space">      </span>margin-top: 3px;</p>
<p class="p1"><span class="Apple-converted-space">    </span>}</p>
<p class="p2"><br></p>
<p class="p1"><span class="Apple-converted-space">    </span>.mapboxgl-popup-anchor-top&gt;.mapboxgl-popup-tip {</p>
<p class="p1"><span class="Apple-converted-space">      </span>border-bottom-color: rgb(61, 59, 59);</p>
<p class="p1"><span class="Apple-converted-space">    </span>}</p>
<p class="p1"><span class="Apple-converted-space">  </span>&lt;/style&gt;</p>
<p class="p1">&lt;/head&gt;</p>
<p class="p2"><br></p>
<p class="p1">&lt;body&gt;</p>
<p class="p2"><br></p>
<p class="p1"><span class="Apple-converted-space">  </span>&lt;div id='map'&gt;&lt;/div&gt;</p>
<p class="p1"><span class="Apple-converted-space">  </span>&lt;script&gt;</p>
<p class="p2"><br></p>
<p class="p1"><span class="Apple-converted-space">    </span>var transformRequest = (url, resourceType) =&gt; {</p>
<p class="p1"><span class="Apple-converted-space">      </span>var isMapboxRequest =</p>
<p class="p1"><span class="Apple-converted-space">        </span>url.slice(8, 22) === "api.mapbox.com" ||</p>
<p class="p1"><span class="Apple-converted-space">        </span>url.slice(10, 26) === "tiles.mapbox.com";</p>
<p class="p1"><span class="Apple-converted-space">      </span>return {</p>
<p class="p1"><span class="Apple-converted-space">        </span>url: isMapboxRequest</p>
<p class="p1"><span class="Apple-converted-space">          </span>? url.replace("?", "?pluginName=sheetMapper&amp;")</p>
<p class="p1"><span class="Apple-converted-space">          </span>: url</p>
<p class="p1"><span class="Apple-converted-space">      </span>};</p>
<p class="p1"><span class="Apple-converted-space">    </span>};</p>
<p class="p1"><span class="Apple-converted-space">    </span>//YOUR TURN: add your Mapbox token</p>
<p class="p2"><span class="Apple-converted-space">    </span></p>
<p class="p1"><span class="Apple-converted-space">    </span>mapboxgl.accessToken = 'pk.eyJ1IjoidGd1eWVyIiwiYSI6ImNsdGRwNjloaTA2Zmwya3Nka3VybW5uOW0ifQ.hOE56hV08FRFvSuYqlCMVg'; //Mapbox token<span class="Apple-converted-space"> </span></p>
<p class="p1"><span class="Apple-converted-space">    </span>var map = new mapboxgl.Map({</p>
<p class="p1"><span class="Apple-converted-space">      </span>container: 'map', // container id</p>
<p class="p1"><span class="Apple-converted-space">      </span>style: 'mapbox://styles/mapbox/streets-v11', // YOUR TURN: choose a style: https://docs.mapbox.com/api/maps/#styles</p>
<p class="p1"><span class="Apple-converted-space">      </span>center: [-122.411, 37.785], // starting position [lng, lat]</p>
<p class="p1"><span class="Apple-converted-space">      </span>zoom: 10,// starting zoom</p>
<p class="p1"><span class="Apple-converted-space">      </span>transformRequest: transformRequest</p>
<p class="p1"><span class="Apple-converted-space">    </span>});</p>
<p class="p2"><br></p>
<p class="p1"><span class="Apple-converted-space">    </span>$(document).ready(function () {</p>
<p class="p1"><span class="Apple-converted-space">      </span>$.ajax({</p>
<p class="p1"><span class="Apple-converted-space">        </span>type: "GET",</p>
<p class="p1"><span class="Apple-converted-space">        </span>//YOUR TURN: Replace with csv export link</p>
<p class="p1"><span class="Apple-converted-space">        </span>url: 'https://docs.google.com/spreadsheets/d/193Kj1hFJnF5-ckTmRjyxR_sTgC1qDKSA_K8MYzua9PI/gviz/tq?tqx=out:csv&amp;sheet=Active%20Dealer%20export',</p>
<p class="p1"><span class="Apple-converted-space">        </span>dataType: "text",</p>
<p class="p1"><span class="Apple-converted-space">        </span>success: function (csvData) { makeGeoJSON(csvData); }</p>
<p class="p1"><span class="Apple-converted-space">      </span>});</p>
<p class="p2"><br></p>
<p class="p2"><br></p>
<p class="p2"><br></p>
<p class="p1"><span class="Apple-converted-space">      </span>function makeGeoJSON(csvData) {</p>
<p class="p1"><span class="Apple-converted-space">        </span>csv2geojson.csv2geojson(csvData, {</p>
<p class="p1"><span class="Apple-converted-space">          </span>latfield: 'Latitude',</p>
<p class="p1"><span class="Apple-converted-space">          </span>lonfield: 'Longitude',</p>
<p class="p1"><span class="Apple-converted-space">          </span>delimiter: ','</p>
<p class="p1"><span class="Apple-converted-space">        </span>}, function (err, data) {</p>
<p class="p1"><span class="Apple-converted-space">          </span>map.on('load', function () {</p>
<p class="p2"><br></p>
<p class="p1"><span class="Apple-converted-space">            </span>//Add the the layer to the map</p>
<p class="p1"><span class="Apple-converted-space">            </span>map.addLayer({</p>
<p class="p1"><span class="Apple-converted-space">              </span>'id': 'csvData',</p>
<p class="p1"><span class="Apple-converted-space">              </span>'type': 'circle',</p>
<p class="p1"><span class="Apple-converted-space">              </span>'source': {</p>
<p class="p1"><span class="Apple-converted-space">                </span>'type': 'geojson',</p>
<p class="p1"><span class="Apple-converted-space">                </span>'data': data</p>
<p class="p1"><span class="Apple-converted-space">              </span>},</p>
<p class="p1"><span class="Apple-converted-space">              </span>'paint': {</p>
<p class="p1"><span class="Apple-converted-space">                </span>'circle-radius': 15,</p>
<p class="p1"><span class="Apple-converted-space">                </span>'circle-color': “red”</p>
<p class="p1"><span class="Apple-converted-space">              </span>}</p>
<p class="p1"><span class="Apple-converted-space">            </span>});</p>
<p class="p2"><br></p>
<p class="p2"><br></p>
<p class="p1"><span class="Apple-converted-space">            </span>// When a click event occurs on a feature in the csvData layer, open a popup at the</p>
<p class="p1"><span class="Apple-converted-space">            </span>// location of the feature, with description HTML from its properties.</p>
<p class="p1"><span class="Apple-converted-space">            </span>map.on('click', 'csvData', function (e) {</p>
<p class="p1"><span class="Apple-converted-space">              </span>var coordinates = e.features[0].geometry.coordinates.slice();</p>
<p class="p2"><br></p>
<p class="p1"><span class="Apple-converted-space">              </span>//set popup text</p>
<p class="p1"><span class="Apple-converted-space">              </span>//You can adjust the values of the popup to match the headers of your CSV.</p>
<p class="p1"><span class="Apple-converted-space">              </span>// For example: e.features[0].properties.Name is retrieving information from the field Name in the original CSV.</p>
<p class="p1"><span class="Apple-converted-space">              </span>var description = `&lt;h3&gt;` + e.features[0].properties.Dealer Name + `&lt;/h3&gt;` + `&lt;h4&gt;` + `&lt;b&gt;` + `Address: ` + `&lt;/b&gt;` + e.features[0].properties.Address + `&lt;/h4&gt;` + `&lt;h4&gt;` + `&lt;b&gt;` + `Phone: ` + `&lt;/b&gt;` + e.features[0].properties.Phone + `&lt;/h4&gt;`;</p>
<p class="p2"><br></p>
<p class="p1"><span class="Apple-converted-space">              </span>// Ensure that if the map is zoomed out such that multiple</p>
<p class="p1"><span class="Apple-converted-space">              </span>// copies of the feature are visible, the popup appears</p>
<p class="p1"><span class="Apple-converted-space">              </span>// over the copy being pointed to.</p>
<p class="p1"><span class="Apple-converted-space">              </span>while (Math.abs(e.lngLat.lng - coordinates[0]) &gt; 180) {</p>
<p class="p1"><span class="Apple-converted-space">                </span>coordinates[0] += e.lngLat.lng &gt; coordinates[0] ? 360 : -360;</p>
<p class="p1"><span class="Apple-converted-space">              </span>}</p>
<p class="p2"><br></p>
<p class="p1"><span class="Apple-converted-space">              </span>//add Popup to map</p>
<p class="p2"><br></p>
<p class="p1"><span class="Apple-converted-space">              </span>new mapboxgl.Popup()</p>
<p class="p1"><span class="Apple-converted-space">                </span>.setLngLat(coordinates)</p>
<p class="p1"><span class="Apple-converted-space">                </span>.setHTML(description)</p>
<p class="p1"><span class="Apple-converted-space">                </span>.addTo(map);</p>
<p class="p1"><span class="Apple-converted-space">            </span>});</p>
<p class="p2"><br></p>
<p class="p1"><span class="Apple-converted-space">            </span>// Change the cursor to a pointer when the mouse is over the places layer.</p>
<p class="p1"><span class="Apple-converted-space">            </span>map.on('mouseenter', 'csvData', function () {</p>
<p class="p1"><span class="Apple-converted-space">              </span>map.getCanvas().style.cursor = 'pointer';</p>
<p class="p1"><span class="Apple-converted-space">            </span>});</p>
<p class="p2"><br></p>
<p class="p1"><span class="Apple-converted-space">            </span>// Change it back to a pointer when it leaves.</p>
<p class="p1"><span class="Apple-converted-space">            </span>map.on('mouseleave', 'places', function () {</p>
<p class="p1"><span class="Apple-converted-space">              </span>map.getCanvas().style.cursor = '';</p>
<p class="p1"><span class="Apple-converted-space">            </span>});</p>
<p class="p2"><br></p>
<p class="p1"><span class="Apple-converted-space">            </span>var bbox = turf.bbox(data);</p>
<p class="p1"><span class="Apple-converted-space">            </span>map.fitBounds(bbox, { padding: 50 });</p>
<p class="p2"><br></p>
<p class="p1"><span class="Apple-converted-space">          </span>});</p>
<p class="p2"><br></p>
<p class="p1"><span class="Apple-converted-space">        </span>});</p>
<p class="p1"><span class="Apple-converted-space">      </span>};</p>
<p class="p1"><span class="Apple-converted-space">    </span>});</p>
<p class="p2"><br></p>
<p class="p2"><br></p>
<p class="p2"><br></p>
<p class="p2"><br></p>
<p class="p1"><span class="Apple-converted-space">  </span>&lt;/script&gt;</p>
<p class="p2"><br></p>
<p class="p1">&lt;/body&gt;</p>
<p class="p2"><br></p>
<p class="p1">&lt;/html&gt;</p>
</body>
</html>
